<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ProofRepo — Compliance ProofPacks in seconds</title>

  <!-- SEO -->
  <meta name="description" content="Compliance ProofPacks in seconds. Auditors use ProofRepo to collect SOC 2 evidence without messy folders or endless correction emails. Companies use it to stay audit-ready with clean inputs, without buying a full GRC platform." />
  <meta name="keywords" content="SOC 2 evidence, ISO 27001 evidence, HIPAA evidence, GDPR evidence, vendor security review, compliance proof, audit readiness" />

  <!-- Open Graph -->
  <meta property="og:title" content="ProofRepo — Compliance ProofPacks in seconds">
  <meta property="og:description" content="Built for boutique auditors and their clients. Guided evidence collection that reduces errors and back-and-forth, without the overhead of a full GRC platform.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://proofrepo.com/">

  <style>
    :root{
      --bg:#0b1020; --gradA:#0b1020; --gradB:#0d1b3d;
      --panel:#10183a; --panel2:#0e1532; --text:#e8edff; --muted:#a7b6e7; --line:#1d2857;
      --primary:#2563eb; --primary2:#3b82f6; --accent:#22c55e; --ring:rgba(37,99,235,.35);
      --r:16px; --rs:12px; --shadow:0 14px 40px rgba(3,7,18,.35); --max:1200px;
      --marqueeH:54px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:linear-gradient(180deg,var(--gradA),var(--gradB));color:var(--text);font:16px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    body{padding-bottom:calc(var(--marqueeH) + env(safe-area-inset-bottom,0px))}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;height:auto}
    .wrap{max-width:var(--max);margin:0 auto;padding:28px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:16px}

    /* NAV */
    .logo{display:flex;align-items:center;gap:10px;font-weight:800}
    .glyph{width:34px;height:34px;border-radius:10px;background:conic-gradient(from 210deg,var(--primary),var(--primary2));box-shadow:var(--shadow)}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 18px;border-radius:999px;border:1px solid #2a3766;cursor:pointer;transition:transform .12s ease, background .12s ease, filter .12s ease}
    .btn:hover{background:#111b3e; transform:translateY(-1px)}
    .btn.primary{background:linear-gradient(135deg,var(--primary),var(--primary2));border-color:transparent;color:#fff;box-shadow:var(--shadow)}
    .btn.primary[disabled]{opacity:.6;cursor:not-allowed;transform:none}
    .btn.link{padding:0;border:0;color:#9db0ff}
    .nav{backdrop-filter:saturate(120%) blur(4px)}

    /* HERO */
    .hero{padding:56px 28px}
    .heroGrid{display:grid;grid-template-columns:1.1fr .9fr;gap:28px;align-items:center}
    .kicker{color:var(--accent);font-weight:800;letter-spacing:.12em;text-transform:uppercase;font-size:.8rem}
    h1{font-size:clamp(28px,4vw,46px);line-height:1.15;margin:10px 0 12px}
    .sub{color:var(--muted);font-size:1.05rem;max-width:60ch}
    .card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--line);border-radius:var(--r);padding:22px;transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease}
    .card:hover{transform:translateY(-2px); box-shadow:0 18px 45px rgba(20,40,120,.35); border-color:#2b3e7a}
    .ticks{display:grid;gap:10px;margin-top:12px}
    .li{display:flex;gap:10px}
    .tick{width:20px;height:20px;border-radius:999px;display:inline-grid;place-items:center;background:linear-gradient(135deg,#34d399,#86efac);color:#062312;font-weight:900;font-size:.8rem}
    .pill{display:inline-block;padding:6px 10px;border:1px solid #2a3766;border-radius:999px;background:#0c1636;color:#a7b9ff;font-size:.85rem}

    /* STICKY BOTTOM MARQUEE */
    .marquee-fixed{position:fixed;left:0;right:0;bottom:0;height:var(--marqueeH);display:flex;align-items:center;border-top:1px solid var(--line);background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,0));backdrop-filter:saturate(120%) blur(6px);z-index:9999;padding-bottom:env(safe-area-inset-bottom,0px)}
    .marquee{white-space:nowrap;overflow:hidden;width:100%}
    .marquee > div{display:inline-block;padding-left:100%;animation:scroll 24s linear infinite;color:#b9c6ff;opacity:.95}
    @keyframes scroll{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}

    /* SECTIONS / GRID */
    .section{padding:40px 28px}
    .grid{display:grid;gap:18px}
    .cols2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .cols3{grid-template-columns:repeat(3,minmax(0,1fr))}
    .muted{color:var(--muted)}
    .small{font-size:.9rem;color:var(--muted)}
    .hint{font-size:.85rem;color:#9fb2ff;margin-top:6px}

    /* PRICING */
    .pricing .plan{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--line);border-radius:14px;padding:20px;display:flex;flex-direction:column;gap:10px; position:relative}
    .pricing h3{margin:0}
    .price{font-size:1.4rem;font-weight:700}
    .popular{border-color:#2b5cff;box-shadow:0 12px 36px rgba(43,92,255,.25)}
    .popular::before{content:"Auditor-focused beta";position:absolute;top:-12px;left:16px;background:#1a2a6b;color:#cfe0ff;padding:4px 10px;border-radius:999px;border:1px solid #27419e;font-size:.78rem}

    /* FORM */
    form{display:grid;gap:14px}
    label{font-weight:600}
    input, select, textarea{width:100%; padding:12px 12px; border-radius:10px; border:1px solid #2a3766; background:#0e1634; color:var(--text)}
    textarea{min-height:110px;resize:vertical}
    .form-row{display:grid;gap:12px}
    .two{grid-template-columns:1fr 1fr}
    .three{grid-template-columns:1fr 1fr 1fr}
    .status{margin-top:8px;padding:10px;border-radius:10px;background:#0d193c;border:1px solid #27356b}
    .status.ok{border-color:#195d3a;background:#0f2a22}
    .status.err{border-color:#7a1a2a;background:#2b0e16}
    .filebox{border:1px dashed #3a4a86;border-radius:12px;padding:14px;transition:border-color .15s ease, background .15s ease}
    .filebox.dragover{border-style:solid;border-color:#4b65ff;background:#0f1a3d}
    .filemeta{font-size:.9rem;color:#a9b8ef}

    .guidance{margin-top:12px;padding:12px 14px;border-radius:10px;border:1px solid #27356b;background:#0d1736;font-size:.9rem}
    .guidance h4{margin:0 0 6px;font-size:.95rem}
    .guidance ul{margin:0;padding-left:18px}
    .guidance li{margin:6px 0}
    .guidance .ok{color:#4ade80}
    .guidance .missing{color:#fca5a5}

    details.advanced{margin-top:8px}
    details.advanced summary{cursor:pointer;font-weight:600;color:#9fb2ff}

    @media (max-width:980px){
      .heroGrid{grid-template-columns:1fr}
      .cols3,.cols2{grid-template-columns:1fr}
    }
    .focusable:focus-visible,.btn:focus-visible,a:focus-visible,summary:focus-visible{outline:3px solid var(--ring);outline-offset:2px;border-radius:10px}
  </style>

  <!-- JSON-LD -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Organization",
    "name":"ProofRepo",
    "url":"https://proofrepo.com",
    "email":"ops@proofrepo.com",
    "description":"Compliance ProofPacks in seconds. Guided evidence collection for boutique auditors and their clients.",
    "address":{
      "@type":"PostalAddress",
      "addressLocality":"Jacksonville",
      "addressRegion":"FL",
      "addressCountry":"US"
    }
  }
  </script>
</head>
<body>
  <!-- NAV -->
  <header class="wrap row nav" role="banner">
    <div class="logo">
      <div class="glyph" aria-hidden="true"></div>
      <span>ProofRepo</span>
    </div>
    <nav class="row" aria-label="primary">
      <a class="btn" href="#pricing">For auditors</a>
      <a class="btn" href="#how">How it works</a>
      <a class="btn" href="#request">Upload evidence</a>
    </nav>
  </header>

  <!-- HERO -->
  <section class="wrap hero">
    <div class="heroGrid">
      <div>
        <div class="kicker">Compliance ProofPacks in seconds</div>
        <h1>Guided SOC&nbsp;2 evidence collection — without Google Drive chaos</h1>
        <p class="sub">
          <strong>Auditors & third parties</strong> use ProofRepo to collect evidence from clients without messy folders,
          broken links, or endless “can you resend this?” emails. Clients see exactly what to upload,
          and you get a structured <strong>ProofPack</strong> that drops straight into workpapers.
          <br><br>
          <strong>Companies</strong> use ProofRepo to be audit-ready with the right inputs — without
          buying a full 5-figure automation suite.
        </p>
        <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:16px">
          <a class="btn primary" href="#request" data-analytics="cta_upload">Upload evidence</a>
          <a class="btn" href="mailto:ops@proofrepo.com?subject=Auditor%20beta" data-analytics="cta_auditor_beta">
            Auditor? Join the beta
          </a>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:14px">
          <span class="pill">Built for boutique audit firms</span>
          <span class="pill">SOC 2 focus (other frameworks tagged)</span>
          <span class="pill">Cleaner than ad-hoc shared folders</span>
          <span class="pill">No “all-in-one” platform required</span>
        </div>
      </div>

      <aside class="card" aria-label="Highlights">
        <div class="ticks">
          <div class="li">
            <span class="tick">✓</span>
            <div><strong>Guided for clients:</strong> fewer wrong files, fewer “oops, wrong export” corrections.</div>
          </div>
          <div class="li">
            <span class="tick">✓</span>
            <div><strong>Auditor-first view:</strong> ProofPack groups files by what they prove (e.g., access review, change log, vendors).</div>
          </div>
          <div class="li">
            <span class="tick">✓</span>
            <div><strong>Focused scope:</strong> we solve evidence collection; you keep your own workpapers and tools.</div>
          </div>
        </div>
        <p class="muted" style="margin-top:12px">
          Today’s beta focuses on <strong>SOC 2</strong> evidence. Other frameworks (ISO 27001, HIPAA, GDPR, NIST CSF)
          can be tagged now so they’re organized for later automation.
        </p>
      </aside>
    </div>
  </section>

  <!-- STICKY BOTTOM MARQUEE -->
  <div class="marquee-fixed" role="region" aria-label="Key highlights">
    <div class="marquee"><div>
      &nbsp;Guided SOC 2 evidence collection • Built for boutique auditors and their clients • Lightweight alternative to messy shared folders • No need for a full 5-figure compliance platform • Beta pricing and Stripe billing coming soon • Ask for complimentary auditor codes at ops@proofrepo.com •
      Guided SOC 2 evidence collection • Built for boutique auditors and their clients • Lightweight alternative to messy shared folders • No need for a full 5-figure compliance platform • Beta pricing and Stripe billing coming soon • Ask for complimentary auditor codes at ops@proofrepo.com •
    </div></div>
  </div>

  <!-- PRICING / POSITIONING -->
  <section id="pricing" class="wrap section pricing" aria-labelledby="pricing-h">
    <h2 id="pricing-h">Built for auditors first, friendly for companies</h2>

    <div class="card" style="margin-bottom:18px;border-style:dashed">
      <strong>Beta stage:</strong>
      <span class="muted">
        We’re working closely with boutique firms and early-stage companies.
        Stripe billing and final pricing are not live yet; we’re proving out the workflow.
      </span>
      <a class="btn primary" style="margin-left:10px" href="mailto:ops@proofrepo.com?subject=Auditor%20beta">
        Request complimentary client codes
      </a>
    </div>

    <div class="grid cols3" role="list">
      <article class="plan popular" role="listitem" aria-label="Auditor-led flows">
        <h3>Auditor-led flows</h3>
        <p class="muted">
          You give clients a link and a short code. They see guided prompts for the right SOC 2 evidence.
          You receive a ProofPack and JSON manifest that records what was provided and what’s missing.
        </p>
        <ul class="muted">
          <li>Client upload, auditor receives the ProofPack</li>
          <li>Automatic hints for Access Review / ChangeLog / Vendors</li>
          <li>Ideal for small SOC 2 and vendor review engagements</li>
        </ul>
        <div class="price">Pricing: based on packs / codes (planned)</div>
      </article>

      <article class="plan" role="listitem" aria-label="Direct company uploads">
        <h3>Companies (direct)</h3>
        <p class="muted">
          No auditor yet? Upload your evidence and get a ProofPack you can reuse with future auditors,
          investors, or customers — without committing to a heavy compliance platform.
        </p>
        <ul class="muted">
          <li>Great for “pre-SOC 2” or diligence prep</li>
          <li>One-off packs now; refresh options later</li>
          <li>Works alongside tools you already use</li>
        </ul>
        <div class="price">Pricing: per pack (planned)</div>
      </article>

      <article class="plan" role="listitem" aria-label="Future Stripe plans">
        <h3>Stripe plans (later)</h3>
        <p class="muted">
          As we harden the flows, we’ll expose Stripe-backed tiers for firms (blocks of client codes
          and packs) and for one-off company use.
        </p>
        <ul class="muted">
          <li>Bundles of client codes for auditors</li>
          <li>Upload-based pricing for companies</li>
          <li>Optional refresh / follow-up flows</li>
        </ul>
        <div class="price small">Not live yet — we’re collecting feedback first.</div>
      </article>
    </div>
  </section>

  <!-- HOW IT WORKS -->
  <section id="how" class="wrap section">
    <h2>How ProofRepo works (today)</h2>
    <div class="grid cols3">
      <div class="card">
        <h3>1) Share or open the link</h3>
        <p class="muted">
          An auditor or company goes to <strong>proofrepo.com</strong>.
          Auditors can share the link plus a short code so uploads are routed and tracked to the right engagement.
        </p>
      </div>
      <div class="card">
        <h3>2) Guided upload</h3>
        <p class="muted">
          The form nudges clients toward the expected SOC 2 artifacts: access reviews, change logs,
          vendor exports, and related proofs. No shared drives, no random screenshots in Slack.
        </p>
      </div>
      <div class="card">
        <h3>3) ProofPack for reviewers</h3>
        <p class="muted">
          ProofRepo generates a structured manifest and a human-friendly viewer that groups files by what they
          prove and flags missing items. You can keep using your own workpapers — just link to the pack.
        </p>
      </div>
    </div>
  </section>

  <!-- FAIR USE & CAPS -->
  <section id="caps" class="wrap section">
    <h2>Behind the scenes: technical limits (beta)</h2>
    <div class="card">
      <p class="muted">
        Internally, we apply small limits to keep the beta stable (roughly “a handful of files” per submission).
        That’s usually enough for SOC 2 evidence like access review exports, change logs, and vendor lists.
      </p>
      <p class="small">
        Files are stored in Cloudflare R2 with an automatic delete rule after a short retention window.
        Final caps and pricing will be based on the <strong>number of uploads / packs</strong>, not on
        trying to meter every individual file.
      </p>
    </div>
  </section>

  <!-- REQUEST / INTAKE -->
  <section id="request" class="wrap section">
    <h2>Upload evidence and get a ProofPack</h2>
    <p class="muted">
      Use this form to send SOC 2 (and related) evidence. You’ll receive a confirmation email with a
      secure ProofPack link. During beta we’re focused on correctness and reviewer experience —
      payments (Stripe, etc.) will plug in later.
    </p>

    <form id="intakeForm" class="card" novalidate>
      <!-- STEP 0: role first -->
      <div class="form-row" id="roleRow">
        <div>
          <label for="role">What is ProofRepo helping you with today?</label>
          <select id="role" name="role">
            <option value="" selected disabled>Choose one…</option>
            <option value="auditor">I’m an auditor or third party collecting evidence from a client</option>
            <option value="client">My auditor sent me here to upload evidence</option>
            <option value="company">I’m a company proactively updating my ProofPack</option>
          </select>
          <div class="hint" id="roleHint">
            We use this for routing, wording, and which fields show up — not for billing.
          </div>
        </div>
      </div>

      <!-- Contact -->
      <div class="form-row two step-after-role" id="contactRow" style="display:none">
        <div>
          <label id="emailLabel" for="email">Work email</label>
          <input id="email" name="email" type="email" required placeholder="you@company.com"/>
        </div>
        <div>
          <label id="companyLabel" for="company">Company</label>
          <input id="company" name="company" required placeholder="Company Inc."/>
        </div>
      </div>

      <!-- Frameworks -->
      <div class="form-row step-after-role" id="frameworkRow" style="display:none">
        <div>
          <label for="frameworks">Framework(s)</label>
          <select id="frameworks" name="frameworks" multiple required>
            <option value="SOC2">SOC 2</option>
            <option value="ISO27001">ISO 27001 (tag only, beta)</option>
            <option value="HIPAA">HIPAA (tag only, beta)</option>
            <option value="GDPR">GDPR (tag only, beta)</option>
            <option value="NIST CSF">NIST CSF (tag only, beta)</option>
            <option value="Other">Other</option>
          </select>
          <div class="hint">SOC 2 is fully wired today. Others are recorded as tags for future automation.</div>
        </div>
      </div>

      <!-- Files (drag & drop) -->
      <div class="filebox step-after-role" id="filesRow" style="display:none">
        <label for="files">
          <strong>Upload artifacts</strong>
          <span class="muted">(Drag and drop or choose files — zip archives are fine.)</span>
        </label>
        <input id="files" name="files" type="file" multiple />
        <div id="fileMeta" class="filemeta">No files selected.</div>
      </div>

      <!-- SOC 2 guidance checklist with manual tagging -->
      <div id="soc2Guide" class="guidance step-after-role" style="display:none">
        <h4>For SOC 2, we typically expect:</h4>
        <ul>
          <li>
            <span id="soc2AccessStatus" class="missing">Access review — not tagged yet</span>
            <div>
              <label class="small" for="soc2AccessSelect">Which file is your access review?</label>
              <select id="soc2AccessSelect"></select>
            </div>
          </li>
          <li>
            <span id="soc2ChangeStatus" class="missing">Change log — not tagged yet</span>
            <div>
              <label class="small" for="soc2ChangeSelect">Which file is your change log?</label>
              <select id="soc2ChangeSelect"></select>
            </div>
          </li>
          <li>
            <span id="soc2VendorStatus" class="missing">Vendor list — not tagged yet</span>
            <div>
              <label class="small" for="soc2VendorSelect">Which file is your vendor list?</label>
              <select id="soc2VendorSelect"></select>
            </div>
          </li>
        </ul>
        <div class="small">
          We’ll auto-suggest based on filenames. If a file is named weirdly, just pick it here so we treat it as the right artifact.
        </div>
      </div>

      <!-- Optional block: everything else -->
      <details class="advanced step-after-role" id="optionalRow" style="display:none">
        <summary>Optional details: codes, emails, context, and advanced mapping</summary>
        <div style="margin-top:12px;display:grid;gap:16px">
          <!-- Plan & coverage (shown after files present) -->
          <div class="form-row two" id="planBillingRow" style="display:none">
            <div>
              <label for="plan">Plan label (beta)</label>
              <select id="plan" name="plan">
                <option value="Trial" selected>Trial</option>
                <option value="OneOff">One-off pack</option>
                <option value="Starter">Starter (planned)</option>
                <option value="Pro">Pro (planned)</option>
              </select>
              <div class="hint">Backend uses this as a label plus simple caps. Real pricing will be upload-based.</div>
            </div>
            <div>
              <label for="billingMode">How will this ProofPack be covered?</label>
              <select id="billingMode" name="billingMode">
                <option value="">Not decided yet</option>
                <option value="code">I have a code from an auditor</option>
                <option value="card">I want to pay by card (Stripe)</option>
              </select>
              <div class="hint" id="billingHint">
                You can decide this later. In beta we mostly use codes or manual billing via ops@proofrepo.com.
              </div>
            </div>
          </div>

          <!-- Routing emails + codes -->
          <div class="form-row three">
            <div id="auditorCodeCol">
              <label for="auditorCode">Auditor code (optional)</label>
              <input id="auditorCode" name="auditorCode" placeholder="Short code from your auditor (e.g. TEST123)"/>
              <div class="hint" id="auditorCodeHint">
                In the future, auditors will get blocks of codes. For now, you can leave this blank or use test codes.
              </div>
            </div>
            <div id="auditorEmailCol">
              <label for="auditorEmail">Auditor email (optional)</label>
              <input id="auditorEmail" name="auditorEmail" type="email" placeholder="auditor@examplefirm.com"/>
              <div class="hint" id="auditorEmailHint">
                We can send the ProofPack link here as well as to your own email.
              </div>
            </div>
            <div id="clientEmailCol">
              <label for="clientEmail">Client email (optional)</label>
              <input id="clientEmail" name="clientEmail" type="email" placeholder="client@company.com"/>
              <div class="hint" id="clientEmailHint">
                If you’re an auditor, add your client contact so we can associate the pack with them (and later, email codes directly).
              </div>
            </div>
          </div>

          <!-- Context (hidden cadence, visible notes) -->
          <input type="hidden" id="cadence" name="cadence" value="">
          <div class="form-row">
            <div>
              <label for="notes">Anything we should know?</label>
              <textarea id="notes" name="notes" placeholder="Deadlines, specific controls, output preferences…"></textarea>
            </div>
          </div>

          <!-- Advanced manual map -->
          <details class="advanced">
            <summary>Advanced: Manual map JSON (optional)</summary>
            <div style="margin-top:8px">
              <label for="map">Manual Map JSON</label>
              <textarea id="map" name="map" class="muted" placeholder='{"AccessReview":"access.csv","ChangeLog":"change.txt","Vendors":"vendors.json"}'></textarea>
              <div class="hint">Most people can ignore this. It overrides the auto-mapping engine for specific files.</div>
            </div>
          </details>
        </div>
      </details>

      <div id="status" class="status" style="display:none"></div>

      <div class="wiz-actions step-after-role" id="actionsRow" style="display:none;gap:10px;justify-content:flex-end">
        <button id="submitBtn" class="btn primary" type="submit">Send and build ProofPack</button>
      </div>
    </form>
  </section>

  <!-- FOOTER -->
  <footer class="wrap">
    <div class="row" style="margin-bottom:8px">
      <div>
        © <span id="y"></span> ProofRepo •
        <a class="btn link" href="mailto:ops@proofrepo.com" data-analytics="cta_mail_footer">ops@proofrepo.com</a>
      </div>
      <div class="tag">Based in Jacksonville, Florida</div>
    </div>
    <div class="small">
      Disclaimer: ProofRepo prepares materials to assist with audits and vendor reviews; it is not a certification or attestation body.
    </div>
  </footer>

  <script>
    // IMPORTANT: stays pointed at your existing Intake Worker.
    const INTAKE_URL = 'https://proofrepo-intake.atucker5.workers.dev/';

    const $ = s => document.querySelector(s);
    const statusEl = $('#status');
    const submitBtn = $('#submitBtn');
    const fileInput = $('#files');
    const fileMeta = $('#fileMeta');
    const fileBox = $('#filesRow');

    const roleSelect = $('#role');
    const emailLabel = $('#emailLabel');
    const companyLabel = $('#companyLabel');
    const roleHint = $('#roleHint');

    const auditorCodeCol = $('#auditorCodeCol');
    const auditorEmailCol = $('#auditorEmailCol');
    const clientEmailCol = $('#clientEmailCol');

    const auditorEmailHint = $('#auditorEmailHint');
    const clientEmailHint = $('#clientEmailHint');

    const billingHint = $('#billingHint');
    const billingSelect = $('#billingMode');

    const optionalDetails = $('#optionalRow');
    const planBillingRow = $('#planBillingRow');

    const soc2Guide = $('#soc2Guide');
    const soc2AccessStatus = $('#soc2AccessStatus');
    const soc2ChangeStatus = $('#soc2ChangeStatus');
    const soc2VendorStatus = $('#soc2VendorStatus');
    const soc2AccessSelect = $('#soc2AccessSelect');
    const soc2ChangeSelect = $('#soc2ChangeSelect');
    const soc2VendorSelect = $('#soc2VendorSelect');

    const laterRows = document.querySelectorAll('.step-after-role');
    const frameworksSelectEl = $('#frameworks');

    // Tracks which file user has tagged for each SOC 2 artifact
    const soc2Selection = {
      AccessReview: '',
      ChangeLog: '',
      Vendors: ''
    };

    document.getElementById('y').textContent = new Date().getFullYear();

    function showStatus(msg, ok=false){
      statusEl.style.display='block';
      statusEl.className = 'status ' + (ok ? 'ok':'err');
      statusEl.innerHTML = msg;
    }
    function clearStatus(){ statusEl.style.display='none'; statusEl.textContent=''; }

    // --- SOC 2 guidance + tagging ---
    function bindSelectHandlers() {
      const configs = [
        { key:'AccessReview', label:'Access review', select:soc2AccessSelect, statusEl:soc2AccessStatus },
        { key:'ChangeLog',    label:'Change log',    select:soc2ChangeSelect, statusEl:soc2ChangeStatus },
        { key:'Vendors',      label:'Vendor list',   select:soc2VendorSelect, statusEl:soc2VendorStatus }
      ];
      configs.forEach(cfg => {
        if (!cfg.select || !cfg.statusEl) return;
        cfg.select.onchange = () => {
          soc2Selection[cfg.key] = cfg.select.value;
          if (cfg.select.value) {
            cfg.statusEl.textContent = `✔ ${cfg.label} — tagged as ${cfg.select.value}`;
            cfg.statusEl.className = 'ok';
          } else {
            cfg.statusEl.textContent = `${cfg.label} — still not tagged`;
            cfg.statusEl.className = 'missing';
          }
        };
      });
    }

    function populateSoc2SelectOptions(files) {
      const configs = [
        { key:'AccessReview', label:'Access review', select:soc2AccessSelect, statusEl:soc2AccessStatus, test:(n)=>/access/i.test(n) },
        { key:'ChangeLog',    label:'Change log',    select:soc2ChangeSelect, statusEl:soc2ChangeStatus, test:(n)=>/change/i.test(n) },
        { key:'Vendors',      label:'Vendor list',   select:soc2VendorSelect, statusEl:soc2VendorStatus, test:(n)=>/(vendor|supplier)/i.test(n) }
      ];

      configs.forEach(cfg => {
        if (!cfg.select || !cfg.statusEl) return;

        const previous = soc2Selection[cfg.key] || '';

        // build options
        cfg.select.innerHTML = '';
        const placeholderOpt = document.createElement('option');
        placeholderOpt.value = '';
        placeholderOpt.textContent = 'Not set / not sure yet';
        cfg.select.appendChild(placeholderOpt);

        files.forEach(f => {
          const opt = document.createElement('option');
          opt.value = f.name;
          opt.textContent = f.name;
          cfg.select.appendChild(opt);
        });

        let selected = previous && files.some(f => f.name === previous) ? previous : '';

        if (!selected) {
          const guess = files.find(f => cfg.test(f.name || ''));
          if (guess) selected = guess.name;
        }

        cfg.select.value = selected;
        soc2Selection[cfg.key] = selected;

        if (selected) {
          cfg.statusEl.textContent = `✔ ${cfg.label} — tagged as ${selected}`;
          cfg.statusEl.className = 'ok';
        } else {
          cfg.statusEl.textContent = `${cfg.label} — still not tagged`;
          cfg.statusEl.className = 'missing';
        }
      });
    }

    function updateGuidance() {
      if (!soc2Guide) return;
      const frameworksSel = document.getElementById('frameworks');
      const selected = Array.from(frameworksSel?.selectedOptions || []).map(o => o.value);
      const hasSOC2 = selected.includes('SOC2');
      const files = Array.from(fileInput?.files || []);

      if (!hasSOC2) {
        soc2Guide.style.display = 'none';
        return;
      }

      soc2Guide.style.display = '';
      populateSoc2SelectOptions(files);
    }

    // ---- File handling (choose + drag & drop) ----
    function updateFileMeta() {
      const files = Array.from(fileInput.files || []);
      if (!files.length) {
        fileMeta.textContent = 'No files selected.';
        if (planBillingRow) planBillingRow.style.display = 'none';
        updateGuidance();
        return;
      }
      const total = files.reduce((n,f)=> n + (f.size || 0), 0);
      const totalMB = (total/1024/1024).toFixed(2);
      fileMeta.textContent = `${files.length} file(s), ${totalMB} MB total`;

      if (planBillingRow) planBillingRow.style.display = '';
      if (optionalDetails) optionalDetails.open = true;

      updateGuidance();
    }

    function handleFilesList(list) {
      if (!list || !list.length) return;
      if (window.DataTransfer) {
        const dt = new DataTransfer();
        Array.from(list).forEach(f => dt.items.add(f));
        fileInput.files = dt.files;
      }
      updateFileMeta();
    }

    if (fileInput) {
      fileInput.addEventListener('change', () => {
        handleFilesList(fileInput.files);
      });
    }

    if (fileBox) {
      ['dragenter','dragover'].forEach(evt => {
        fileBox.addEventListener(evt, e => {
          e.preventDefault();
          e.stopPropagation();
          fileBox.classList.add('dragover');
        });
      });
      ['dragleave','dragend'].forEach(evt => {
        fileBox.addEventListener(evt, e => {
          e.preventDefault();
          e.stopPropagation();
          fileBox.classList.remove('dragover');
        });
      });
      fileBox.addEventListener('drop', e => {
        e.preventDefault();
        e.stopPropagation();
        fileBox.classList.remove('dragover');
        if (e.dataTransfer && e.dataTransfer.files) {
          handleFilesList(e.dataTransfer.files);
        }
      });
    }

    function updateBillingUI() {
      if (!billingSelect) return;
      const billing = billingSelect.value;
      const role = roleSelect.value;

      if (!billing) {
        billingHint.textContent = 'You can decide this later. In beta we mostly use codes or manual billing via ops@proofrepo.com.';
      } else if (billing === 'code') {
        billingHint.textContent = 'Enter an auditor code if you have one, or leave it blank in beta. We’ll mainly use codes for coverage.';
      } else if (billing === 'card') {
        billingHint.textContent = 'Card payment via Stripe will live here. For now, this is a placeholder — use codes or email ops@proofrepo.com.';
      }

      if (billing === 'code' && role !== 'company' && role) {
        auditorCodeCol.style.display = 'block';
      } else if (billing === 'code' && role === 'company') {
        auditorCodeCol.style.display = 'none';
      }
    }

    // Dynamic UI for role
    function updateRoleUI() {
      const role = roleSelect.value;

      if (!role) {
        laterRows.forEach(r => r.style.display = 'none');
        roleHint.textContent = "Start by telling us which side of the audit you're on.";
        return;
      }

      laterRows.forEach(r => {
        if (r.id === 'actionsRow') r.style.display = 'flex';
        else r.style.display = '';
      });

      if (role === 'auditor') {
        emailLabel.textContent = 'Auditor email';
        companyLabel.textContent = 'Client company';
        roleHint.textContent = 'You’re an auditor (or third party) driving this pack. You’ll get the ProofPack link and can forward it to your client or reviewers.';

        auditorEmailCol.style.display = 'none';
        clientEmailCol.style.display = 'block';
        clientEmailHint.textContent = 'Add your client contact so we can associate the pack with them (and later, email codes directly).';
      } else if (role === 'client') {
        emailLabel.textContent = 'Your email';
        companyLabel.textContent = 'Your company';
        roleHint.textContent = 'Use this if your auditor pointed you here to upload SOC 2 evidence.';

        auditorEmailCol.style.display = 'block';
        clientEmailCol.style.display = 'none';
        auditorEmailHint.textContent = 'If you know your auditor’s email, add it so we can also route the ProofPack to them.';
      } else { // company
        emailLabel.textContent = 'Your email';
        companyLabel.textContent = 'Your company';
        roleHint.textContent = 'Direct company use: preparing for an audit or vendor review without an auditor driving this yet.';

        auditorEmailCol.style.display = 'none';
        clientEmailCol.style.display = 'none';
      }

      updateBillingUI();
      updateGuidance();
    }

    if (roleSelect) {
      roleSelect.addEventListener('change', updateRoleUI);
    }
    if (billingSelect) {
      billingSelect.addEventListener('change', updateBillingUI);
    }
    if (frameworksSelectEl) {
      frameworksSelectEl.addEventListener('change', updateGuidance);
    }

    // Initial UI setup
    document.getElementById('y').textContent = new Date().getFullYear();
    bindSelectHandlers();
    updateRoleUI();
    updateBillingUI();
    updateGuidance();

    function validate(){
      const roleVal = document.getElementById('role').value;
      if (!roleVal) return 'Please tell us what ProofRepo is helping you with today.';

      const email = $('#email').value.trim();
      const company = $('#company').value.trim();
      if (!email) return 'Please enter a valid work email.';
      if (!company) return 'Please enter your company name.';

      const frameworksSel = document.getElementById('frameworks');
      const fws = Array.from(frameworksSel.selectedOptions || []).map(o=>o.value);
      if (fws.length === 0) return 'Please select at least one framework (SOC 2 is fully supported).';

      const files = Array.from(fileInput.files || []);
      const planEl = document.getElementById('plan');
      const plan = planEl ? (planEl.value || 'Trial') : 'Trial';

      const total = files.reduce((n,f)=> n + (f.size || 0), 0);

      if (files.length === 0) {
        return 'Please upload at least one file so we can build a ProofPack.';
      }

      if (plan === 'Trial') {
        if (files.length > 10) return 'Trial is tuned for roughly 10 files. If needed, zip extras together.';
        if (total > 5 * 1024 * 1024) return 'Right now the trial is tuned for small uploads (~5 MB). Please zip or trim your upload.';
      } else {
        if (files.length > 50) return 'For large batches, split into multiple submissions.';
      }

      // Enforce SOC 2 minimums
      if (fws.includes('SOC2')) {
        const missingKinds = [];
        if (!soc2Selection.AccessReview) missingKinds.push('access review');
        if (!soc2Selection.ChangeLog) missingKinds.push('change log');
        if (!soc2Selection.Vendors) missingKinds.push('vendor list');
        if (missingKinds.length) {
          return 'For SOC 2, please tag which files correspond to: ' + missingKinds.join(', ') + '.';
        }
      }

      return null;
    }

    function gather(){
      const fd = new FormData();
      const planEl = document.getElementById('plan');
      const cadenceEl = document.getElementById('cadence');

      fd.append('email', document.getElementById('email').value.trim());
      fd.append('company', document.getElementById('company').value.trim());
      fd.append('plan', planEl ? (planEl.value || 'Trial') : 'Trial');
      fd.append('cadence', cadenceEl ? (cadenceEl.value || '') : '');
      fd.append('role', document.getElementById('role').value || 'client');

      if (billingSelect && billingSelect.value) {
        fd.append('billingMode', billingSelect.value);
      }

      const frameworksSel = document.getElementById('frameworks');
      Array.from(frameworksSel.selectedOptions || []).forEach(o => fd.append('frameworks', o.value));

      const notesEl = document.getElementById('notes');
      fd.append('notes', notesEl ? notesEl.value.trim() : '');

      const auditorCode = document.getElementById('auditorCode').value.trim();
      const auditorEmail = document.getElementById('auditorEmail').value.trim();
      const clientEmail = document.getElementById('clientEmail').value.trim();
      if (auditorCode) fd.append('auditorCode', auditorCode);
      if (auditorEmail) fd.append('auditorEmail', auditorEmail);
      if (clientEmail) fd.append('clientEmail', clientEmail);

      const mapEl = document.getElementById('map');
      let mapVal = mapEl ? mapEl.value.trim() : '';

      // If user didn't hand-write JSON, synthesize from SOC 2 selections
      if (!mapVal &&
          (soc2Selection.AccessReview || soc2Selection.ChangeLog || soc2Selection.Vendors)) {
        const autoMap = {};
        if (soc2Selection.AccessReview) autoMap.AccessReview = soc2Selection.AccessReview;
        if (soc2Selection.ChangeLog) autoMap.ChangeLog = soc2Selection.ChangeLog;
        if (soc2Selection.Vendors) autoMap.Vendors = soc2Selection.Vendors;
        mapVal = JSON.stringify(autoMap);
      }
      if (mapVal) fd.append('map', mapVal);

      Array.from(fileInput.files || []).forEach(f => fd.append('files', f, f.name));
      return fd;
    }

    document.getElementById('intakeForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      clearStatus();
      const err = validate();
      if (err) { showStatus(err, false); return; }

      submitBtn.disabled = true;
      submitBtn.textContent = 'Uploading…';

      try{
        const res = await fetch(INTAKE_URL, { method:'POST', body: gather() });
        const text = await res.text();
        let json = null;
        try { json = JSON.parse(text); } catch (_) {}

        if (!res.ok || !json || json.ok === false) {
          const msg = (json && json.error) ? json.error : `Upload failed (${res.status})`;
          showStatus(msg, false);
        } else {
          const keys = (json.keys || []).map(k => `<code>${k}</code>`).join('<br>');
          const viewer = json.viewerUrl || json.packUrl;
          const linkHtml = viewer
            ? `<br><br><a href="${viewer}" target="_blank" rel="noopener">Open ProofPack viewer</a>`
            : '';

          // Try to surface missing items if the worker sent them
          let missingHtml = '';
          if (json.missingSummary) {
            missingHtml = json.missingSummary;
          } else if (Array.isArray(json.needs) && json.needs.length) {
            missingHtml = json.needs.join('<br>');
          } else if (json.needs && typeof json.needs === 'object') {
            const parts = [];
            for (const fw in json.needs) {
              if (!json.needs[fw] || !json.needs[fw].length) continue;
              parts.push(`${fw}: ${json.needs[fw].join(', ')}`);
            }
            if (parts.length) missingHtml = parts.join('<br>');
          }

          const missingBlock = missingHtml
            ? `<br><br><strong>Missing items detected:</strong><br>${missingHtml}`
            : '';

          showStatus(
            `✅ Received! ${json.usage?.files || json.keys?.length || 0} file(s) saved.<br>
             A ProofPack email will arrive shortly.${missingBlock}${linkHtml}<br><br>${keys || ''}`,
            true
          );
        }
      } catch(err){
        showStatus(`Network error: ${err.message}`, false);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send and build ProofPack';
      }
    });
  </script>
</body>
</html>
