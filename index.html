<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ProofRepo — Compliance ProofPacks in seconds</title>

  <!-- SEO -->
  <meta name="description" content="Compliance ProofPacks in seconds. Auditors and third parties use ProofRepo to collect SOC 2 and other framework evidence without messy folders or endless correction emails. Companies use it to stay audit- or event-ready without buying a full automation suite." />
  <meta name="keywords" content="SOC 2 evidence, ISO 27001 evidence, HIPAA evidence, GDPR evidence, vendor security review, compliance proof, audit readiness" />

  <!-- Open Graph -->
  <meta property="og:title" content="ProofRepo — Compliance ProofPacks in seconds">
  <meta property="og:description" content="Built for boutique auditors and their clients. Guided evidence collection that reduces errors and back-and-forth, without the overhead of a full GRC platform.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://proofrepo.com/">
  <meta property="og:image" content="https://proofrepo.com/og.png">

  <link rel="canonical" href="https://proofrepo.com/">
  <meta name="twitter:card" content="summary_large_image">

  <style>
    :root{
      --bg:#0b1020; --gradA:#0b1020; --gradB:#0d1b3d;
      --panel:#10183a; --panel2:#0e1532; --text:#e8edff; --muted:#a7b6e7; --line:#1d2857;
      --primary:#2563eb; --primary2:#3b82f6; --accent:#22c55e; --ring:rgba(37,99,235,.35);
      --r:16px; --rs:12px; --shadow:0 14px 40px rgba(3,7,18,.35); --max:1200px;
      --marqueeH:54px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:linear-gradient(180deg,var(--gradA),var(--gradB));color:var(--text);font:16px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    body{padding-bottom:calc(var(--marqueeH) + env(safe-area-inset-bottom,0px))}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;height:auto}
    .wrap{max-width:var(--max);margin:0 auto;padding:28px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:16px}

    /* NAV */
    .logo{display:flex;align-items:center;gap:10px;font-weight:800}
    .glyph{width:34px;height:34px;border-radius:10px;background:conic-gradient(from 210deg,var(--primary),var(--primary2));box-shadow:var(--shadow)}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 18px;border-radius:999px;border:1px solid #2a3766;cursor:pointer;transition:transform .12s ease, background .12s ease, filter .12s ease}
    .btn:hover{background:#111b3e; transform:translateY(-1px)}
    .btn.primary{background:linear-gradient(135deg,var(--primary),var(--primary2));border-color:transparent;color:#fff;box-shadow:var(--shadow)}
    .btn.primary[disabled]{opacity:.6;cursor:not-allowed;transform:none}
    .btn.link{padding:0;border:0;color:#9db0ff}
    .nav{backdrop-filter:saturate(120%) blur(4px)}

    /* HERO */
    .hero{padding:56px 28px}
    .heroGrid{display:grid;grid-template-columns:1.1fr .9fr;gap:28px;align-items:center}
    .kicker{color:var(--accent);font-weight:800;letter-spacing:.12em;text-transform:uppercase;font-size:.8rem}
    h1{font-size:clamp(28px,4vw,46px);line-height:1.15;margin:10px 0 12px}
    .sub{color:var(--muted);font-size:1.05rem;max-width:60ch}
    .card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--line);border-radius:var(--r);padding:22px;transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease}
    .card:hover{transform:translateY(-2px); box-shadow:0 18px 45px rgba(20,40,120,.35); border-color:#2b3e7a}
    .ticks{display:grid;gap:10px;margin-top:12px}
    .li{display:flex;gap:10px}
    .tick{width:20px;height:20px;border-radius:999px;display:inline-grid;place-items:center;background:linear-gradient(135deg,#34d399,#86efac);color:#062312;font-weight:900;font-size:.8rem}
    .pill{display:inline-block;padding:6px 10px;border:1px solid #2a3766;border-radius:999px;background:#0c1636;color:#a7b9ff;font-size:.85rem}

    /* STICKY BOTTOM MARQUEE */
    .marquee-fixed{position:fixed;left:0;right:0;bottom:0;height:var(--marqueeH);display:flex;align-items:center;border-top:1px solid var(--line);background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,0));backdrop-filter:saturate(120%) blur(6px);z-index:9999;padding-bottom:env(safe-area-inset-bottom,0px)}
    .marquee{white-space:nowrap;overflow:hidden;width:100%}
    .marquee > div{display:inline-block;padding-left:100%;animation:scroll 24s linear infinite;color:#b9c6ff;opacity:.95}
    @keyframes scroll{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}

    /* SECTIONS / GRID */
    .section{padding:40px 28px}
    .grid{display:grid;gap:18px}
    .cols2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .cols3{grid-template-columns:repeat(3,minmax(0,1fr))}
    .muted{color:var(--muted)}
    .small{font-size:.9rem;color:var(--muted)}
    .tag{color:var(--muted);font-size:.9rem}
    .hint{font-size:.85rem;color:#9fb2ff;margin-top:6px}

    /* PRICING */
    .pricing .plan{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--line);border-radius:14px;padding:20px;display:flex;flex-direction:column;gap:10px; position:relative}
    .pricing h3{margin:0}
    .price{font-size:1.4rem;font-weight:700}
    .popular{border-color:#2b5cff;box-shadow:0 12px 36px rgba(43,92,255,.25)}

    /* FORM */
    form{display:grid;gap:14px}
    label{font-weight:600}
    input, select, textarea{width:100%; padding:12px 12px; border-radius:10px; border:1px solid #2a3766; background:#0e1634; color:var(--text)}
    textarea{min-height:110px;resize:vertical}
    .form-row{display:grid;gap:12px}
    .two{grid-template-columns:1fr 1fr}
    .three{grid-template-columns:1fr 1fr 1fr}
    .status{margin-top:8px;padding:10px;border-radius:10px;background:#0d193c;border:1px solid #27356b}
    .status.ok{border-color:#195d3a;background:#0f2a22}
    .status.err{border-color:#7a1a2a;background:#2b0e16}
    .filebox{border:1px dashed #3a4a86;border-radius:12px;padding:14px;transition:border-color .15s ease, background .15s ease}
    .filebox.dragover{border-style:solid;border-color:#4b65ff;background:#0f1a3d}
    .filemeta{font-size:.9rem;color:#a9b8ef}

    .guidance{margin-top:12px;padding:12px 14px;border-radius:10px;border:1px solid #27356b;background:#0d1736;font-size:.9rem}
    .guidance h4{margin:0 0 6px;font-size:.95rem}
    .guidance ul{margin:0;padding-left:18px}
    .guidance li{margin:6px 0}
    .guidance .ok{color:#4ade80}
    .guidance .missing{color:#fca5a5}

    details.advanced{margin-top:8px}
    details.advanced summary{cursor:pointer;font-weight:600;color:#9fb2ff}

    @media (max-width:980px){
      .heroGrid{grid-template-columns:1fr}
      .cols3,.cols2{grid-template-columns:1fr}
    }
    .focusable:focus-visible,.btn:focus-visible,a:focus-visible,summary:focus-visible{outline:3px solid var(--ring);outline-offset:2px;border-radius:10px}
  </style>

  <!-- JSON-LD -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Organization",
    "name":"ProofRepo",
    "url":"https://proofrepo.com",
    "email":"ops@proofrepo.com",
    "description":"Compliance ProofPacks in seconds. Guided evidence collection for boutique auditors and their clients.",
    "address":{
      "@type":"PostalAddress",
      "addressLocality":"Jacksonville",
      "addressRegion":"FL",
      "addressCountry":"US"
    }
  }
  </script>
</head>
<body>
  <!-- NAV -->
  <header class="wrap row nav" role="banner">
    <div class="logo">
      <div class="glyph" aria-hidden="true"></div>
      <span>ProofRepo</span>
    </div>
    <nav class="row" aria-label="primary">
      <a class="btn" href="#companies">For companies</a>
      <a class="btn" href="#how">How it works</a>
      <a class="btn" href="#request">Upload evidence</a>
    </nav>
  </header>

  <!-- HERO -->
  <section class="wrap hero">
    <div class="heroGrid">
      <div>
        <div class="kicker">Compliance ProofPacks in seconds</div>
        <h1>Streamlined evidence collection — without Drive, Dropbox, or email chaos</h1>
        <p class="sub">
          ProofRepo replaces scattered Google Drive folders, ad-hoc Dropbox links, and
          long email threads with a single guided flow for compliance evidence.
          <br><br>
          <strong>Auditors and third parties</strong> use ProofRepo to collect the right
          artifacts from clients — mapped to controls and ready for workpapers.
          <br><br>
          <strong>Companies</strong> use ProofRepo to be audit- or review-ready with clean,
          correctly labeled inputs, without buying a big-ticket compliance suite.
        </p>
        <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:16px">
          <a class="btn primary" href="#request" data-analytics="cta_upload">Upload evidence</a>
         
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:14px">
          <span class="pill">Built for boutique audit firms</span>
          <span class="pill">SOC 2, ISO 27001, HIPAA, GDPR, NIST CSF</span>
          <span class="pill">Cleaner than ad-hoc Google Drives</span>
          <span class="pill">No $20k “all-in-one” suite required</span>
        </div>
      </div>

      <aside class="card" aria-label="Highlights">
        <div class="ticks">
          <div class="li">
            <span class="tick">✓</span>
            <div><strong>Guided for clients:</strong> fewer wrong files, fewer “oops, wrong export” corrections.</div>
          </div>
          <div class="li">
            <span class="tick">✓</span>
            <div><strong>Reviewer-first view:</strong> ProofPack groups files by what they prove (e.g., access review, change log, vendors).</div>
          </div>
          <div class="li">
            <span class="tick">✓</span>
            <div><strong>Lightweight by design:</strong> no agents, no dashboards — just evidence in → ProofPack out.</div>
          </div>
        </div>
        <p class="muted" style="margin-top:12px">
          Today’s beta supports <strong>SOC 2</strong> plus guided minimums for ISO 27001, HIPAA,
          GDPR, and NIST CSF so you can keep everything organized as your program grows.
        </p>
      </aside>
    </div>
  </section>

    <!-- REQUEST / INTAKE -->
  <section id="request" class="wrap section">
    <h2>Upload evidence and get a ProofPack</h2>
    <p class="muted">
      Use this form to send SOC 2 and related evidence. You’ll receive a confirmation email with a
      secure ProofPack link. During beta we’re focused on correctness and reviewer experience —
      payments (Stripe, etc.) will plug in later.
    </p>

    <form id="intakeForm" class="card" novalidate>
      <!-- STEP 0: role first -->
      <div class="form-row" id="roleRow">
        <div>
          <label for="role">What is ProofRepo helping you with today?</label>
          <select id="role" name="role" required>
            <option value="" selected disabled>Choose one…</option>
            <option value="auditor">I’m an auditor or a third party collecting evidence from a company</option>
            <option value="client">A third party sent me here to upload evidence documentation to generate a ProofPack</option>
            <option value="company">I’m a company proactively updating my ProofPack</option>
          </select>
          <div class="hint" id="roleHint">
            We use this for routing, wording, and which fields show up — not for billing.
          </div>
        </div>
      </div>

      <!-- Contact -->
      <div class="form-row two step-after-role" id="contactRow" style="display:none">
        <div>
          <label id="emailLabel" for="email">Work email</label>
         <input id="email" name="email" type="email" required placeholder="you@company.com" autocomplete="email"/>
<div class="hint" id="emailHint" style="margin-top:6px"></div>
        </div>
        <div>
          <label id="companyLabel" for="company">Company</label>
          <input id="company" name="company" required placeholder="Company Inc." autocomplete="organization"/>
        </div>
      </div>

      <!-- Frameworks -->
      <div class="form-row step-after-role" id="frameworkRow" style="display:none">
        <div>
          <label for="frameworks">Framework(s)</label>
          <select id="frameworks" name="frameworks" multiple required>
            <option value="SOC2" selected>SOC 2</option>
            <option value="ISO27001">ISO 27001</option>
            <option value="HIPAA">HIPAA</option>
            <option value="GDPR">GDPR</option>
            <option value="NIST CSF">NIST CSF</option>
            <option value="Other">Other</option>
          </select>
          <div class="hint">Select all that apply. The guided checklist will show minimum evidence for each framework.</div>
        </div>
      </div>

      <!-- Files (drag & drop) -->
      <div class="filebox step-after-role" id="filesRow" style="display:none">
        <label for="files">
          <strong>Upload artifacts</strong>
          <span class="muted">(Drag and drop or choose files — zip archives are fine.)</span>
        </label>
        <input id="files" name="files" type="file" multiple />
        <div id="fileMeta" class="filemeta">No files selected.</div>
      </div>

      <!-- Dynamic framework guidance / tagging -->
      <div id="frameworkGuides" class="guidance step-after-role" style="display:none"></div>

            <!-- ROUTING (moved out of Optional so codes can be entered before upload) -->
      <div class="form-row three step-after-role" id="routingRow" style="display:none">
        <div id="auditorCodeCol">
          <label for="auditorCode">Auditor / third-party code (optional)</label>
          <input id="auditorCode" name="auditorCode" placeholder="Short code (e.g. TEST123)"/>
          <div class="hint" id="auditorCodeHint">
            If you have a code from an auditor / reviewer, enter it now so your ProofPack is routed correctly.
          </div>
        </div>

        <div id="auditorEmailCol">
          <label for="auditorEmail">Auditor / third-party email (optional)</label>
          <input id="auditorEmail" name="auditorEmail" type="email" placeholder="reviewer@examplefirm.com"/>
          <div class="hint" id="auditorEmailHint">
            If you know the reviewer’s email, add it so we can route the ProofPack to them too.
          </div>
        </div>

        <div id="clientEmailCol">
          <label for="clientEmail">Client contact email (optional)</label>
          <input id="clientEmail" name="clientEmail" type="email" placeholder="client@company.com"/>
          <div class="hint" id="clientEmailHint">
            If you’re an auditor, add your client contact so we can associate the pack with them.
          </div>
        </div>
      </div>

      <!-- Optional block: everything else -->
      <details class="advanced step-after-role" id="optionalRow" style="display:none">
       <summary>Optional details: plan label, context, and advanced mapping</summary>
        <div style="margin-top:12px;display:grid;gap:16px">
          <!-- Plan & coverage (shown after files present) -->
          <div class="form-row two" id="planBillingRow" style="display:none">
            <div>
              <label for="plan">Plan label (beta)</label>
              <select id="plan" name="plan">
                <option value="Trial" selected>Trial</option>
                <option value="OneOff">One-off pack</option>
                <option value="Starter">Starter (planned)</option>
                <option value="Pro">Pro (planned)</option>
              </select>
              <div class="hint">Backend uses this as a label plus simple caps. Real pricing will be upload-based.</div>
            </div>
            <div>
              <label for="billingMode">How will this ProofPack be covered?</label>
              <select id="billingMode" name="billingMode">
                <option value="">Not decided yet</option>
                <option value="code">I have a code from an auditor / third party</option>
                <option value="card">I want to pay by card (Stripe)</option>
              </select>
              <div class="hint" id="billingHint">
                You can decide this later. In beta we mostly use codes or manual billing via ops@proofrepo.com.
              </div>
            </div>
          </div>

          <!-- Context (hidden cadence, visible notes) -->
          <input type="hidden" id="cadence" name="cadence" value="">
          <div class="form-row">
            <div>
              <label for="notes">Anything we should know?</label>
              <textarea id="notes" name="notes" placeholder="Deadlines, specific controls, output preferences…"></textarea>
            </div>
          </div>

          <!-- Advanced manual map -->
          <details class="advanced">
            <summary>Advanced: Manual map JSON (optional)</summary>
            <div style="margin-top:8px">
              <label for="map">Manual Map JSON</label>
              <textarea id="map" name="map" class="muted" placeholder='{"AccessReview":"access.csv","ChangeLog":"change.txt","Vendors":"vendors.json"}'></textarea>
              <div class="hint">Most people can ignore this. It overrides the auto-mapping engine for specific files.</div>
            </div>
          </details>
        </div>
      </details>

      <div id="status" class="status" style="display:none"></div>

      <div class="wiz-actions step-after-role" id="actionsRow" style="display:none;gap:10px;justify-content:flex-end">
        <button id="submitBtn" class="btn primary" type="submit">Send and build ProofPack</button>
      </div>
    </form>
  </section>

<!-- PRICING (hidden until role selected) -->
<section id="pricing" class="wrap section pricing" aria-labelledby="pricing-h" style="display:none">
  <h2 id="pricing-h">Pricing</h2>
  <p class="small muted">
    Pay per ProofPack. No subscriptions. Purchase bundles for use across multiple companies, clients, or internal evidence requests.
  </p>

  <div class="grid cols3" role="list">
    <!-- One-off -->
    <article class="plan" role="listitem" aria-label="One-off ProofPack">
      <h3>One-off ProofPack</h3>
      <div class="price">$29</div>
      <p class="muted">For a single ProofPack—either to request evidence from a company or to generate one directly.</p>
      <ul class="muted">
        <li>1 ProofPack credit</li>
        <li>Guided SOC 2 tagging</li>
        <li>Reusable ProofPack output</li>
      </ul>
      <a class="btn primary" href="mailto:ops@proofrepo.com?subject=One-off%20ProofPack">Buy pack</a>
      <div class="small">Checkout flow coming next.</div>
    </article>

    <!-- Bundle 25 -->
    <article class="plan popular" role="listitem" aria-label="ProofPack bundle 25">
      <h3>ProofPack Bundle — 25</h3>
      <div class="price">$199</div>
      <p class="muted">Best for pilots and smaller teams running evidence requests across multiple engagements.</p>
      <ul class="muted">
        <li>25 ProofPack credits</li>
        <li>Designed for repeat client workflows</li>
        <li>No subscription required</li>
      </ul>
      <a class="btn primary" href="mailto:ops@proofrepo.com?subject=ProofPack%20Bundle%2025">Buy pack</a>
      <div class="small">Checkout flow coming next.</div>
    </article>

    <!-- Bundle 50 -->
    <article class="plan" role="listitem" aria-label="ProofPack bundle 50">
      <h3>ProofPack Bundle — 50</h3>
      <div class="price">$349</div>
      <p class="muted">Most common fit for teams who want a clean, repeatable evidence collection motion.</p>
      <ul class="muted">
        <li>50 ProofPack credits</li>
        <li>Great for seasonal audit waves</li>
        <li>No subscription required</li>
      </ul>
      <a class="btn primary" href="mailto:ops@proofrepo.com?subject=ProofPack%20Bundle%2050">Buy pack</a>
    </article>

    <!-- Bundle 75 -->
    <article class="plan" role="listitem" aria-label="ProofPack bundle 75">
      <h3>ProofPack Bundle — 75</h3>
      <div class="price">$499</div>
      <p class="muted">Designed for higher-volume workflows across many clients or recurring vendor reviews.</p>
      <ul class="muted">
        <li>75 ProofPack credits</li>
        <li>Built for repeat workflows</li>
        <li>No subscription required</li>
      </ul>
      <a class="btn primary" href="mailto:ops@proofrepo.com?subject=ProofPack%20Bundle%2075">Buy pack</a>
    </article>
  </div>

  <div class="card" style="margin-top:18px">
    <strong class="muted">How it works:</strong>
    <div class="muted" style="margin-top:8px">
      Use a ProofPack credit to request evidence or generate a ProofPack. Bundles are for repeated use across multiple engagements.
    </div>
  </div>
</section>


<!-- TRUST -->
<section id="trust" class="wrap section" aria-labelledby="trust-h">
  <h2 id="trust-h">Trust, privacy, and retention</h2>

  <div class="grid cols2">
    <div class="card">
      <h3>Private by default</h3>
      <p class="muted">
        ProofPacks are shared via secure, unguessable links. No public indexing.
      </p>
      <p class="small">
        Only people you share the link with can access the ProofPack.
      </p>
    </div>

    <div class="card">
      <h3>Storage + retention</h3>
      <p class="muted">
        Files are stored in Cloudflare R2 and automatically deleted after a short retention window.
      </p>
      <p class="small">
        If you need different retention, email <a class="btn link" href="mailto:ops@proofrepo.com">ops@proofrepo.com</a>.
      </p>
    </div>
  </div>

  <div class="card" style="margin-top:18px">
    <h3>We don’t “read your evidence”</h3>
    <p class="muted">
      The guided tagging uses filenames + your selections to organize what each file proves.
      Reviewers use the ProofPack viewer to evaluate evidence in context.
    </p>
    <p class="small">
      You control what you upload and who receives the ProofPack link.
    </p>
  </div>
</section>
  
    <!-- FOR COMPANIES -->
  <section id="companies" class="wrap section" aria-labelledby="companies-h">
    <h2 id="companies-h">For companies</h2>

    <div class="grid cols2">
      <div class="card">
        <h3>Get audit- and review-ready</h3>
        <p class="muted">
          Upload evidence once and keep a clean ProofPack you can reuse with auditors, customers, investors, and partners.
        </p>
      </div>

      <div class="card">
        <h3>Reduce “please resend” loops</h3>
        <p class="muted">
          Guided prompts + required SOC 2 tagging helps prevent wrong exports, wrong date ranges, and missing artifacts.
        </p>
      </div>
    </div>
  </section>

  <!-- HOW IT WORKS -->
  <section id="how" class="wrap section">
    <h2>How ProofRepo works (today)</h2>
    <div class="grid cols3">
      <div class="card">
        <h3>1) Share or open the link</h3>
        <p class="muted">
          An auditor, third party, or company goes to <strong>proofrepo.com</strong>.
          Auditors can share the link plus a short code so uploads are routed and tracked to the right engagement.
        </p>
      </div>
      <div class="card">
        <h3>2) Guided upload</h3>
        <p class="muted">
          The form nudges uploaders toward the expected artifacts for the frameworks selected.
          No shared drives, no random screenshots in Slack.
        </p>
      </div>
      <div class="card">
        <h3>3) ProofPack for reviewers</h3>
        <p class="muted">
          ProofRepo generates a structured manifest and a human-friendly viewer that groups files by what they
          prove and flags missing items. You can keep using your own workpapers — just link to the pack.
        </p>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="wrap">
    <div class="row" style="margin-bottom:8px">
      <div>
        © <span id="y"></span> ProofRepo •
        <a class="btn link" href="mailto:ops@proofrepo.com" data-analytics="cta_mail_footer">ops@proofrepo.com</a>
      </div>
      <div class="tag">Based in Jacksonville, Florida</div>
    </div>
    <div class="small">
      Disclaimer: ProofRepo prepares materials to assist with audits and vendor reviews; it is not a certification or attestation body.
    </div>
  </footer>

  <script>
    // IMPORTANT: stays pointed at your existing Intake Worker.
    const INTAKE_URL = 'https://proofrepo-intake.atucker5.workers.dev/';

    const FRAMEWORK_CONFIG = {
      SOC2: {
        label: 'SOC 2',
        key: 'SOC2',
        items: [
          { id: 'AccessReview', label: 'Access review', mapKey: 'AccessReview', patterns: [/access/i, /user.*review/i] },
          { id: 'ChangeLog',    label: 'Change log',    mapKey: 'ChangeLog',    patterns: [/change/i, /deploy|release/i] },
          { id: 'Vendors',      label: 'Vendor list',   mapKey: 'Vendors',      patterns: [/vendor|supplier|third[-_ ]party/i] }
        ]
      },
      ISO27001: {
        label: 'ISO 27001',
        key: 'ISO27001',
        items: [
          { id: 'AssetRegister', label: 'Asset inventory / register', patterns: [/asset/i, /inventory/i] },
          { id: 'RiskRegister',  label: 'Risk register',              patterns: [/risk/i] },
          { id: 'SoA',           label: 'Statement of Applicability (SoA)', patterns: [/soa/i, /statement.*applicability/i] }
        ]
      },
      HIPAA: {
        label: 'HIPAA',
        key: 'HIPAA',
        items: [
          { id: 'BAAList',   label: 'Business Associate Agreements (BAAs)', patterns: [/baa/i, /business.*associate/i] },
          { id: 'PHIAccess', label: 'PHI access log',                       patterns: [/phi/i, /access.*log/i] }
        ]
      },
      GDPR: {
        label: 'GDPR',
        key: 'GDPR',
        items: [
          { id: 'RoPA', label: 'Record of Processing Activities (RoPA)', patterns: [/ropa/i, /processing.*activities/i] },
          { id: 'DPA',  label: 'Data processing agreements',            patterns: [/dpa/i, /processing.*agreement/i] }
        ]
      },
      'NIST CSF': {
        label: 'NIST CSF',
        key: 'NIST CSF',
        items: [
          { id: 'Policies',       label: 'Core security policies', patterns: [/policy/i] },
          { id: 'RiskAssessment', label: 'Risk assessment',        patterns: [/risk.*assessment/i] }
        ]
      }
    };

const $ = s => document.querySelector(s);
    
// ===== PATCH UTILS (escape + safeUrl) =====
const esc = (s = '') =>
  String(s)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;');

const safeUrl = (u) => {
  try {
    const url = new URL(String(u), window.location.href);
    if (url.protocol !== 'https:' && url.protocol !== 'http:') return '';
    return url.toString();
  } catch {
    return '';
  }
};    
// ===== /PATCH UTILS =====

    const statusEl = $('#status');
    const submitBtn = $('#submitBtn');
    const fileInput = $('#files');
    const fileMeta = $('#fileMeta');
    const fileBox = $('#filesRow');

    const roleSelect = $('#role');
    const emailLabel = $('#emailLabel');
    const companyLabel = $('#companyLabel');
    const roleHint = $('#roleHint');

    const auditorCodeCol = $('#auditorCodeCol');
    const auditorEmailCol = $('#auditorEmailCol');
    const clientEmailCol = $('#clientEmailCol');

    const auditorEmailHint = $('#auditorEmailHint');
    const clientEmailHint = $('#clientEmailHint');

    const billingHint = $('#billingHint');
    const billingSelect = $('#billingMode');

    const optionalDetails = $('#optionalRow');
    const planBillingRow = $('#planBillingRow');

    const frameworksSelectEl = $('#frameworks');
    const frameworkGuides = $('#frameworkGuides');

    const laterRows = document.querySelectorAll('.step-after-role');
    const pricingSection = document.getElementById('pricing');


    // frameworkSelections[frameworkKey][itemId] = filename
    const frameworkSelections = {};
    // ===== PATCH: always have SOC2 map ready =====
frameworkSelections.SOC2 = frameworkSelections.SOC2 || {};
// Pre-seed SOC2 required keys so validation is deterministic
for (const item of (FRAMEWORK_CONFIG.SOC2?.items || [])) {
  if (!(item.id in frameworkSelections.SOC2)) frameworkSelections.SOC2[item.id] = '';
}
// ===== /PATCH =====

    document.getElementById('y').textContent = new Date().getFullYear();

function showStatus(msg, ok=false){
  statusEl.style.display = 'block';
  statusEl.className = 'status ' + (ok ? 'ok' : 'err');
  statusEl.innerHTML = msg;
}
function clearStatus(){
  statusEl.style.display = 'none';
  statusEl.innerHTML = '';
}

// Ensure SOC2 is selected by default (even if the <select multiple> started hidden)
if (frameworksSelectEl && frameworksSelectEl.selectedOptions.length === 0) {
  const soc2Opt = Array.from(frameworksSelectEl.options).find(o => o.value === 'SOC2');
  if (soc2Opt) soc2Opt.selected = true;
}


// Keep Optional Details hidden until files are added (pre-GTM simpler flow)
if (optionalDetails) {
  optionalDetails.style.display = 'none';
  optionalDetails.open = false;
}

    function getSelectedFrameworkKeys() {
      const fs = Array.from(frameworksSelectEl?.selectedOptions || []).map(o => o.value);
      return fs;
    }

    function updateItemStatusSpan(span, label, selectedName) {
      if (!span) return;
      if (selectedName) {
        span.textContent = '✔ ' + label + ' — tagged as ' + selectedName;
        span.className = 'ok';
      } else {
        span.textContent = label + ' — not tagged yet';
        span.className = 'missing';
      }
    }

    function renderFrameworkGuides() {
      if (!frameworkGuides) return;
      const selectedKeys = getSelectedFrameworkKeys().filter(k => FRAMEWORK_CONFIG[k]);
const files = Array.from(fileInput?.files || []);

// Hide until frameworks selected AND at least 1 file exists
if (!selectedKeys.length || !files.length) {
  frameworkGuides.style.display = 'none';
  frameworkGuides.innerHTML = '';
  return;
}


      frameworkGuides.style.display = '';
      frameworkGuides.innerHTML = '';

      selectedKeys.forEach(fwKey => {
        const cfg = FRAMEWORK_CONFIG[fwKey];
        if (!cfg) return;
        const block = document.createElement('div');
        block.style.marginBottom = '12px';

        const h4 = document.createElement('h4');
        h4.textContent = (fwKey === 'SOC2')
  ? (cfg.label + ' — required items (needed to build your ProofPack)')
  : (cfg.label + ' — recommended minimum evidence');
        block.appendChild(h4);

        const ul = document.createElement('ul');

        cfg.items.forEach(item => {
          if (!frameworkSelections[fwKey]) frameworkSelections[fwKey] = {};

          const li = document.createElement('li');

          const statusSpan = document.createElement('span');
          statusSpan.id = `fw-${fwKey}-${item.id}-status`;
          statusSpan.className = 'missing';
          statusSpan.textContent = item.label + ' — not tagged yet';
          li.appendChild(statusSpan);

          const div = document.createElement('div');
          const label = document.createElement('label');
          label.className = 'small';
          label.htmlFor = `fw-${fwKey}-${item.id}-select`;
          label.textContent = `Which file is your ${item.label.toLowerCase()}?`;
          div.appendChild(label);

          const select = document.createElement('select');
          select.id = `fw-${fwKey}-${item.id}-select`;
          select.dataset.framework = fwKey;
          select.dataset.item = item.id;

          const noneOpt = document.createElement('option');
          noneOpt.value = '';
          noneOpt.textContent = 'Not set / not sure yet';
          select.appendChild(noneOpt);

          files.forEach(f => {
            const opt = document.createElement('option');
            opt.value = f.name;
            opt.textContent = f.name;
            select.appendChild(opt);
          });

          // restore or auto-guess
          const prev = frameworkSelections[fwKey][item.id] || '';
          let selectedName = prev && files.some(f => f.name === prev) ? prev : '';

          if (!selectedName && files.length && item.patterns && item.patterns.length) {
            const guess = files.find(f => item.patterns.some(re => re.test(f.name || '')));
            if (guess) selectedName = guess.name;
          }

          select.value = selectedName;
          frameworkSelections[fwKey][item.id] = selectedName;
          updateItemStatusSpan(statusSpan, item.label, selectedName);

          select.addEventListener('change', () => {
            const fw = select.dataset.framework;
            const it = select.dataset.item;
            if (!frameworkSelections[fw]) frameworkSelections[fw] = {};
            frameworkSelections[fw][it] = select.value;
            updateItemStatusSpan(statusSpan, item.label, select.value);
          });

          div.appendChild(select);
          li.appendChild(div);
          ul.appendChild(li);
        });

        block.appendChild(ul);
        frameworkGuides.appendChild(block);
      });

      const info = document.createElement('div');
      info.className = 'small';
      info.textContent = 'We auto-suggest based on filenames. If something is named weirdly, just pick it so we treat it as the right artifact.';
      frameworkGuides.appendChild(info);
    }

// File handling & drag/drop
function updateFileMeta() {
  const files = Array.from(fileInput?.files || []);

  if (!files.length) {
    if (fileMeta) fileMeta.textContent = 'No files selected.';
    if (planBillingRow) planBillingRow.style.display = 'none';

    // Hide optional details until files exist
    if (optionalDetails) {
      optionalDetails.style.display = 'none';
      optionalDetails.open = false;
    }

    renderFrameworkGuides();
    return;
  }

  const total = files.reduce((n, f) => n + (f.size || 0), 0);
  const totalMB = (total / 1024 / 1024).toFixed(2);

  if (fileMeta) fileMeta.textContent = `${files.length} file(s), ${totalMB} MB total`;

  if (planBillingRow) planBillingRow.style.display = '';

  // Show optional details once files exist, but keep it collapsed
  if (optionalDetails) {
    optionalDetails.style.display = '';
    optionalDetails.open = false;
  }

  renderFrameworkGuides();
}


    function handleFilesList(list) {
  if (!list || !list.length) return;

  try {
    if (window.DataTransfer) {
      const dt = new DataTransfer();
      Array.from(list).forEach(f => dt.items.add(f));
      fileInput.files = dt.files;
    }
  } catch (_) {
    // Some browsers (older Safari/iOS) don't allow programmatic file assignment.
    // We'll still update UI and let native input behavior handle selection.
  }

  updateFileMeta();
}

    if (fileInput) {
      fileInput.addEventListener('change', () => handleFilesList(fileInput.files));
    }

    if (fileBox) {
      ['dragenter','dragover'].forEach(evt => {
        fileBox.addEventListener(evt, e => {
          e.preventDefault();
          e.stopPropagation();
          fileBox.classList.add('dragover');
        });
      });
      ['dragleave','dragend'].forEach(evt => {
        fileBox.addEventListener(evt, e => {
          e.preventDefault();
          e.stopPropagation();
          fileBox.classList.remove('dragover');
        });
      });
      fileBox.addEventListener('drop', e => {
        e.preventDefault();
        e.stopPropagation();
        fileBox.classList.remove('dragover');
        if (e.dataTransfer && e.dataTransfer.files) {
          handleFilesList(e.dataTransfer.files);
        }
      });
    }

function updateBillingUI() {
  if (!billingSelect) return;
  const billing = billingSelect.value;
  const role = roleSelect.value;

  if (!billing) {
    billingHint.textContent = 'You can decide this later. In beta we mostly use codes or manual billing via ops@proofrepo.com.';
  } else if (billing === 'code') {
    billingHint.textContent = 'Enter a code if you have one, or leave it blank in beta. We’ll mainly use codes for coverage.';
  } else if (billing === 'card') {
    billingHint.textContent = 'Card payment via Stripe will live here. For now this is a placeholder — use codes or email ops@proofrepo.com.';
  }

  if (billing === 'code' && role && role !== 'company') {
    auditorCodeCol.style.display = 'block';
  } else if (billing === 'code' && role === 'company') {
    auditorCodeCol.style.display = 'none';
  }
}

function updateRoleUI() {
  const role = roleSelect.value;

  // Email placeholder + hint helper
  const emailHintEl = document.getElementById('emailHint');
  const emailInput = document.getElementById('email');

  if (emailHintEl && emailInput) {
    if (role === 'auditor') {
      emailInput.placeholder = 'you@auditfirm.com';
      emailHintEl.textContent = 'Use your auditor / reviewer email here.';
    } else {
      emailInput.placeholder = 'you@company.com';
      emailHintEl.textContent = '';
    }
  }

  if (!role) {
    laterRows.forEach(r => (r.style.display = 'none'));
    const routingRow = document.getElementById('routingRow');
    if (routingRow) routingRow.style.display = 'none';
    roleHint.textContent = "Start by telling us which side of the audit you're on.";
    
    if (pricingSection) pricingSection.style.display = 'none';
    
    return;
  }

  if (pricingSection) pricingSection.style.display = 'block';


  // Show the post-role rows as usual…
  laterRows.forEach(r => {
    // override inline display:none
    if (r.id === 'actionsRow') r.style.display = 'flex';
    else r.style.display = 'block';
  });

  // Routing row special-case: hide for company
  const routingRow = document.getElementById('routingRow');
  if (routingRow) routingRow.style.display = (role === 'company') ? 'none' : 'block';

  // ...but keep Optional Details hidden until files exist
  const hasFiles = (fileInput && fileInput.files && fileInput.files.length > 0);
  if (optionalDetails) {
    optionalDetails.style.display = hasFiles ? '' : 'none';
    optionalDetails.open = false; // keep collapsed either way
  }

  if (role === 'auditor') {
    emailLabel.textContent = 'Auditor / third-party email';
    companyLabel.textContent = 'Client company';
    roleHint.textContent =
      'You’re an auditor or third party driving this pack. You’ll get the ProofPack link and can forward it to your client or reviewers.';

    auditorEmailCol.style.display = 'none';
    clientEmailCol.style.display = 'block';
    clientEmailHint.textContent =
      'Add your client contact so we can associate the pack with them (and later, email codes directly).';
  } else if (role === 'client') {
    emailLabel.textContent = 'Your email';
    companyLabel.textContent = 'Your company';
    roleHint.textContent =
      'Use this if an auditor or third party pointed you here to upload evidence.';

    auditorEmailCol.style.display = 'block';
    clientEmailCol.style.display = 'none';
    auditorEmailHint.textContent =
      'If you know the reviewer’s email, add it so we can also route the ProofPack to them.';
  } else { // company
    emailLabel.textContent = 'Your email';
    companyLabel.textContent = 'Your company';
    roleHint.textContent =
      'Direct company use: preparing for an audit or vendor review without an auditor driving this yet.';

    auditorEmailCol.style.display = 'none';
    clientEmailCol.style.display = 'none';
  }

  updateBillingUI();
  renderFrameworkGuides();
}

    if (roleSelect) roleSelect.addEventListener('change', updateRoleUI);
    if (billingSelect) billingSelect.addEventListener('change', updateBillingUI);
    if (frameworksSelectEl) frameworksSelectEl.addEventListener('change', renderFrameworkGuides);

    // Initial UI
    updateRoleUI();
    updateBillingUI();
    renderFrameworkGuides();
    updateFileMeta();
    
    function validate(){
      const roleVal = document.getElementById('role').value;
      if (!roleVal) return 'Please tell us what ProofRepo is helping you with today.';

const email = $('#email').value.trim().toLowerCase();
const company = $('#company').value.trim();

// 1) allowlist your own test emails
const ALLOWLIST = new Set([
  'atucker5@alumni.nd.edu',
  // add more if you want:
  // 'you@proofrepo.com',
]);

// 2) basic email format check
const looksLikeEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
if (!looksLikeEmail) return 'Please enter a valid email address.';

// 3) “work email” check for everyone else (block common personal domains)
const PERSONAL_DOMAINS = new Set([
  'gmail.com','yahoo.com','outlook.com','hotmail.com','icloud.com','aol.com',
  'proton.me','protonmail.com','gmx.com','mail.com','live.com','msn.com'
]);

const domain = email.split('@')[1] || '';
const isPersonal = PERSONAL_DOMAINS.has(domain);

// allow allowlist OR non-personal domains
if (!ALLOWLIST.has(email) && isPersonal) {
  return 'Please use a work email (or contact ops@proofrepo.com if you need an exception).';
}

if (!company) return 'Please enter your company name.';

      const frameworksSel = document.getElementById('frameworks');
      const fws = Array.from(frameworksSel.selectedOptions || []).map(o=>o.value);
      if (fws.length === 0) return 'Please select at least one framework.';

      const files = Array.from(fileInput.files || []);
      const planEl = document.getElementById('plan');
      const plan = planEl ? (planEl.value || 'Trial') : 'Trial';

      const total = files.reduce((n,f)=> n + (f.size || 0), 0);

      if (files.length === 0) {
        return 'Please upload at least one file so we can build a ProofPack.';
      }

      if (plan === 'Trial') {
        if (files.length > 10) return 'Trial is tuned for roughly 10 files. If needed, zip extras together.';
        if (total > 5 * 1024 * 1024) return 'Right now the trial is tuned for small uploads (~5 MB). Please zip or trim your upload.';
      } else {
        if (files.length > 50) return 'For large batches, split into multiple submissions.';
      }

// Enforce *required* minimums ONLY for SOC2 (backend hard-blocks SOC2; others are guidance-only)
const missing = [];
const soc2Selected = fws.includes('SOC2');

if (soc2Selected) {
  const cfg = FRAMEWORK_CONFIG.SOC2;
  const sel = frameworkSelections.SOC2 || {};
  (cfg.items || []).forEach(item => {
    if (!sel[item.id]) missing.push(`${cfg.label}: ${item.label}`);
  });
}

if (missing.length) {
  return 'For SOC 2, please tag files for these required items:\n• ' + missing.join('\n• ');
}

      return null;
    }

    function gather(){
      const fd = new FormData();
      const planEl = document.getElementById('plan');
      const cadenceEl = document.getElementById('cadence');

      fd.append('email', document.getElementById('email').value.trim());
      fd.append('company', document.getElementById('company').value.trim());
      fd.append('plan', planEl ? (planEl.value || 'Trial') : 'Trial');
      fd.append('cadence', (cadenceEl && cadenceEl.value) ? cadenceEl.value : '');
      fd.append('role', document.getElementById('role').value || 'client');

      if (billingSelect && billingSelect.value) {
        fd.append('billingMode', billingSelect.value);
      }

      const frameworksSel = document.getElementById('frameworks');
      Array.from(frameworksSel.selectedOptions || []).forEach(o => fd.append('frameworks', o.value));

      const notesEl = document.getElementById('notes');
      fd.append('notes', notesEl ? notesEl.value.trim() : '');

      const auditorCode = document.getElementById('auditorCode').value.trim();
      const auditorEmail = document.getElementById('auditorEmail').value.trim();
      const clientEmail = document.getElementById('clientEmail').value.trim();
      if (auditorCode) fd.append('auditorCode', auditorCode);
      if (auditorEmail) fd.append('auditorEmail', auditorEmail);
      if (clientEmail) fd.append('clientEmail', clientEmail);

      const mapEl = document.getElementById('map');
      let mapVal = mapEl ? mapEl.value.trim() : '';

      // If user didn't hand-write JSON, synthesize from frameworkSelections
      if (!mapVal) {
        const autoMap = {};
        Object.keys(frameworkSelections).forEach(fwKey => {
          const cfg = FRAMEWORK_CONFIG[fwKey];
          const sel = frameworkSelections[fwKey] || {};
          if (!cfg) return;
          (cfg.items || []).forEach(item => {
            const filename = sel[item.id];
            if (!filename) return;
            if (fwKey === 'SOC2' && item.mapKey) {
              // flat keys for compatibility with existing worker
              autoMap[item.mapKey] = filename;
            } else {
              if (!autoMap[fwKey]) autoMap[fwKey] = {};
              autoMap[fwKey][item.id] = filename;
            }
          });
        });
        if (Object.keys(autoMap).length) {
          mapVal = JSON.stringify(autoMap);
        }
      }

      if (mapVal) fd.append('map', mapVal);

      Array.from(fileInput.files || []).forEach(f => fd.append('files', f, f.name));
      return fd;
    }

document.getElementById('intakeForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  clearStatus();

  const err = validate();
  if (err) {
    showStatus(esc(err).replace(/\n/g, '<br>'), false);
    return;
  }

  submitBtn.disabled = true;
  submitBtn.textContent = 'Uploading…';

  // Worker returns needs like: [{ framework:"SOC2", missing:[...] }, ...]
  function renderNeedsHtml(needs) {
    if (!needs) return '';

    if (Array.isArray(needs)) {
      const lines = [];
      for (const n of needs) {
        const fw = n?.framework || 'Framework';
        const missing = Array.isArray(n?.missing) ? n.missing : [];
        if (!missing.length) continue;
        lines.push(`<strong>${esc(fw)}:</strong> ${missing.map(x => esc(String(x))).join(', ')}`);
      }
      return lines.join('<br>');
    }

    // fallback if needs is an object shape
    if (typeof needs === 'object') {
      const parts = [];
      for (const fw in needs) {
        const arr = needs[fw];
        if (!Array.isArray(arr) || !arr.length) continue;
        parts.push(`<strong>${esc(fw)}:</strong> ${arr.map(x => esc(String(x))).join(', ')}`);
      }
      return parts.join('<br>');
    }

    return esc(String(needs));
  }

  try {
    const res = await fetch(INTAKE_URL, { method: 'POST', body: gather() });
    const text = await res.text();

    let json = null;
    try { json = JSON.parse(text); } catch (_) {}

    if (!res.ok || !json || json.ok === false) {
      const msg = (json && json.error) ? json.error : `Upload failed (${res.status})`;
      showStatus(esc(msg), false);
      return;
    }

    const filesCount =
      json?.usage?.files ??
      (Array.isArray(json?.saved) ? json.saved.length : 0);

    const viewer = safeUrl(json.viewerUrl || json.packUrl);
    const linkHtml = viewer
      ? `<br><br><a href="${esc(viewer)}" target="_blank" rel="noopener noreferrer">Open ProofPack viewer</a>`
      : '';

    // IMPORTANT: never trust backend HTML; escape it
    const needsHtml = json.missingSummary
      ? esc(String(json.missingSummary)).replace(/\n/g, '<br>')
      : renderNeedsHtml(json.needs);

    const missingBlock = needsHtml
      ? `<br><br><strong>Missing items (backend):</strong><br>${needsHtml}`
      : '';

    const packUrl = safeUrl(json.packUrl);
    const packUrlHtml = packUrl
      ? `<br><br><strong>Signed JSON:</strong> <a href="${esc(packUrl)}" target="_blank" rel="noopener noreferrer">Open</a>`
      : '';

    const manifestKey = json.manifestKey
      ? `<br><strong>Manifest key:</strong> <code>${esc(json.manifestKey)}</code>`
      : '';

    const emailOk =
      (json.emailOk === true) ? 'Yes' :
      (json.emailOk === false) ? 'No (check email config)' :
      'Unknown';

    const emailBlock = `<br><strong>Email sent:</strong> ${esc(emailOk)}`;

    const fixEnds = json.fixWindowEndsAt
      ? `<br><strong>Fix window ends:</strong> ${esc(json.fixWindowEndsAt)}`
      : '';

    showStatus(
      `✅ Received! <strong>${esc(filesCount)}</strong> file(s) saved.<br>
       A ProofPack email will arrive shortly.${missingBlock}${linkHtml}
       <div class="small">${emailBlock}${fixEnds}${manifestKey}${packUrlHtml}</div>`,
      true
    );
  } catch (err) {
    showStatus(esc(`Network error: ${err?.message || err}`), false);
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = 'Send and build ProofPack';
  }
});
  </script>

  <!-- STICKY BOTTOM MARQUEE -->
  <div class="marquee-fixed" role="region" aria-label="Key highlights">
    <div class="marquee"><div>
      &nbsp;Guided SOC 2 evidence collection • Built for boutique auditors and their clients • Lightweight alternative to messy shared folders • No need for a full 5-figure compliance platform • Beta pricing and Stripe billing coming soon • Ask for complimentary auditor codes at ops@proofrepo.com •
      Guided SOC 2 evidence collection • Built for boutique auditors and their clients • Lightweight alternative to messy shared folders • No need for a full 5-figure compliance platform • Beta pricing and Stripe billing coming soon • Ask for complimentary auditor codes at ops@proofrepo.com •
    </div></div>
  </div>

</body>
</html>
